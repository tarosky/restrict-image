{"version":3,"sources":["components/container.js"],"names":["$","Vue","component","template","data","computed","containerStyle","props","TaroimgContainer","width","endpoint","type","String","required","methods","deleteImage","method","url","this","beforeSend","xhr","response","self","image","id","fail","setRequestHeader","nonce","done","responseJSON","status","message","always","deleting","$emit","images","limit","postId","default","loading","uploadable","directory","Number","mounted","throwError","length","uploadErrorHandler","uploadHandler","push","event","callback","ajax","media","index","imageToDeleted","forEach","i","success","noImageToDelete","splice","jQuery"],"mappings":";;;;;;;;;;;CAMA,SAAAA,GAIEC,IAAAC,UAAA,gBAGEC,SAAAA,8YAWCC,KAZ4B,WAa7BC,OACEC,UAAAA,IACSD,UAGRC,eAAA,WAlB0B,OAoB7BC,MAAOC,iBAAAC,MAAA,QACEF,OAIPG,OACEC,KAAMC,OACNC,QAAAA,MA3ByBH,UA8B7BI,KAASF,OACPG,UAAAA,IAGEf,SACEgB,YAAQ,WACRC,IAAAA,EAAKC,KACLC,KAAAA,UAAY,EACVC,EAAAA,MACDJ,OAAA,SALHC,IAAAC,KAMQR,SAASW,eAATC,EAA+BC,MAAAC,GACrCF,WAAW,SAAAF,GACVK,EAAKC,iBAAA,aAAkBlB,iBAAAmB,UAExBC,KAAGP,SAASQ,EAATC,EAAyBT,GAC1BU,EAAAA,MAAAA,gBAAmBF,EAATP,EAAsBS,MAAhCP,GAAA,MACDC,KAAA,SAAAJ,GACDC,IAAAA,EAAW,GACVU,EAAOH,cAAUR,EAAAQ,aAAAE,UAClBT,EAAKW,EAALJ,aAAAE,SAEHT,EAAAY,MAAA,gBAAA,EAAAZ,EAAAC,MAAAC,GAAAO,KArBMC,OAAA,WA9BXV,EAAAW,UAAA,QAmEME,IAAAA,UAAQ,qBACRC,SAAAA,maASFC,KAAAA,WACE1B,OACAE,UACAyB,MAAAA,EAHMC,SAAA,IAORC,OACEC,WAFM9B,KAAAC,OAIRF,UAAU,GAET2B,QAlC+B1B,KAAA+B,OAoClCC,UAAS,EACPL,QAAW,IAIbxB,UAZE0B,WAAY,WAcZI,OAAAA,IAAY1B,KAAAkB,OAAAlB,KAASa,OAAQc,OAAA3B,KAAAkB,OAE5B1B,SAJM,WARL,OAAOF,iBAAiBE,SAAWQ,KAAKuB,YAgBzCE,QARM,WAUPG,KAAAA,aAAAA,SAAoBzB,EAAAS,EAAAV,OAGhBW,SAEFa,WAAKA,SAAWb,GAfXb,KAAAgB,MAAA,WAAAH,IAmBLgB,cAAW,SAAXxB,GACAL,KAAKqB,OAALS,KAAezB,IAGbN,mBAAUP,SAFLuC,EAAA5B,GAGLF,IAAAA,EAAY,GACVC,EAAIM,cAAkBL,EAAtBQ,aAAoCrB,UACrCuB,EAAAV,EAAAQ,aAAAE,SAEDT,KAAAA,WAAcD,IAGZ6B,aAAAA,SAAAA,GACD,IAAA5B,EAAAJ,KACFA,KAAEO,SAAK,EACNzB,EAAAmD,MACAnC,OAAGK,MACDU,IAAAA,KAAAA,SACDZ,WAAA,SAAAC,GACDE,EAAKsB,iBAAL,aAAApC,iBAAAmB,UAEAL,KAAKiB,SAAUlB,EAAfS,EAAAV,GAnBFE,EAAAa,OAAAd,EAAA+B,MArBK9B,EAAAc,MAAAf,EAAAe,MA8BAc,GAcPnC,EAAaM,EAAAS,EAAAV,KAETK,KAAI4B,SAAQhC,GACZ,IAAIiC,EAAAA,GACJjC,EAAYkC,cAAQlC,EAAgBmC,aAAEzB,UACpCA,EAAGP,EAAHK,aAAmBE,SAEjBuB,EAAAA,WAAAA,KACAtB,OAAA,WACDV,EAAAiB,SAAA,KAIFxB,YAAI,SAAA0C,EAAAjC,EAAAO,GACH,GAAA0B,EAAKtB,CACL,IAAAkB,EAAA,KACDC,EAAA,KAfHpC,KAgBKiB,OAAAoB,QAAA,SAAAhC,EAAAiC,GACH,GAAKZ,IAAAA,EAAWb,GA9Db,OA+DJsB,EAAAG,EACFF,EAAA/B,GAhEM,IAuDA,OAAS8B,EACVnC,KAAK0B,WAAWpC,iBAAiBkD,kBAEjCxC,KAAKiB,OAAOwB,OAAON,EAAO,GAC1BnC,KAAKgB,MAAM,gBAAiBoB,SAG9BpC,KAAK0B,WAAWb,OApK1B,CA4KG6B","file":"../../components/container.js","sourcesContent":["/*!\n * Image container\n *\n * wpdeps=taroimg-uploader\n */\n\n/*global TaroimgContainer: false*/\n\n(function ($) {\n\n  'use strict';\n\n  Vue.component( 'taroimg-item', {\n    template: `\n      <div :class=\"{'taroimg-item': true, 'deleting': deleting}\" :style=\"containerStyle\">\n          <button class=\"taroimg-item-delete\" type=\"button\" @click=\"deleteImage\">&times;</button>\n          <img class=\"taroimg-item-thumbnail\" :src=\"image.thumbnail\" :alt=\"image.title\" v-if=\"image.thumbnail\" />\n          <span class=\"taroimg-item-label\">{{image.name}}</span>\n      </div>\n    `,\n    data: function(){\n      return {\n        deleting: false,\n      };\n    },\n    computed: {\n      containerStyle: function() {\n        return {\n          width: TaroimgContainer.width + 'px',\n        };\n      }\n    },\n    props: {\n      image: {\n        type: Object,\n        default: null\n      },\n      endpoint: {\n        type: String,\n        required: true\n      }\n    },\n    methods: {\n      deleteImage: function(){\n        let self = this;\n        this.deleting = true;\n        $.ajax({\n          method: 'delete',\n          url: this.endpoint + '?attachment=' + self.image.id,\n          beforeSend: function ( xhr ) {\n            xhr.setRequestHeader( 'X-WP-Nonce', TaroimgContainer.nonce );\n          },\n        }).done(function(response, status, xhr){\n          self.$emit('delete-image', true, self.image.id, '');\n        }).fail(function(response){\n          let message = '';\n          if(response.responseJSON && response.responseJSON.message){\n            message = response.responseJSON.message;\n          }\n          self.$emit('delete-image', false, self.image.id, message);\n        }).always(function(){\n          self.deleting = false;\n        });\n      },\n    }\n  } );\n\n  Vue.component( 'taroimg-container', {\n    template: `\n    <div>\n        <div class=\"taroimg-list\">\n            <taroimg-item v-for=\"image in images\" :key=\"image.id\" :endpoint=\"endpoint\" :image=\"image\" @delete-image=\"deleteImage\">\n            </taroimg-item>\n        </div>\n        <taroimg-uploader v-if=\"uploadable\" :directory=\"directory\" :post-id=\"postId\" @upload-finished=\"uploadHandler\" @upload-error=\"uploadErrorHandler\"></taroimg-uploader>\n    </div>\n    `,\n    data: function(){\n      return {\n        images: [],\n        limit: 0,\n        loading: false,\n      };\n    },\n    props: {\n      directory: {\n        type: String,\n        required: true\n      },\n      postId: {\n        type: Number,\n        required: false,\n        default: 0\n      }\n    },\n    computed: {\n      uploadable: function(){\n        return 0 === this.limit || this.images.length < this.limit;\n      },\n      endpoint: function(){\n        return TaroimgContainer.endpoint + this.directory;\n      }\n    },\n    mounted: function(){\n      let self = this;\n      this.getImageList(function(response, status, xhr){\n      });\n    },\n    methods: {\n\n      throwError: function(message){\n        this.$emit('on-error', message);\n      },\n\n      uploadHandler: function(image){\n        this.images.push(image);\n      },\n\n      uploadErrorHandler: function(event, response){\n        let message = '';\n        if(response.responseJSON && response.responseJSON.message){\n          message = response.responseJSON.message;\n        }\n        this.throwError(message);\n      },\n\n      getImageList: function(callback) {\n        let self = this;\n        this.loading = true;\n        $.ajax({\n          method: 'get',\n          url: this.endpoint,\n          beforeSend: function ( xhr ) {\n            xhr.setRequestHeader( 'X-WP-Nonce', TaroimgContainer.nonce );\n          },\n        }).done(function(response, status, xhr){\n          self.images = response.media;\n          self.limit  = response.limit;\n          if(callback){\n            callback(response, status, xhr);\n          }\n        }).fail(function(response){\n          let message = '';\n          if(response.responseJSON && response.responseJSON.message){\n            message = response.responseJSON.message;\n          }\n          self.throwError( message );\n        }).always(function(){\n          self.loading = false;\n        });\n      },\n\n      deleteImage: function(success, id, message) {\n        if(success){\n          let index = null;\n          let imageToDeleted = null;\n          this.images.forEach(function(image, i){\n            if(id === image.id){\n              index = i;\n              imageToDeleted = image;\n              return false;\n            }\n          });\n          if(null === index){\n            this.throwError(TaroimgContainer.noImageToDelete);\n          }else{\n            this.images.splice(index, 1);\n            this.$emit('image-deleted', imageToDeleted);\n          }\n        }else{\n          this.throwError(message);\n        }\n      }\n    }\n  } );\n\n\n\n})(jQuery);\n"]}