"use strict";
/*!
 * File uploader
 *
 * wpdeps=jquery,vue-js
 */
/*!
 * File uploader
 *
 * wpdeps=jquery,vue-js
 */
!function(t){Vue.component("taroimg-uploader",{template:'\n    <div>\n\n    <form :action="actionUrl" enctype="multipart/form-data" method="post"\n\t\t\t:class="{\'taroimg-form\': true, undroppable: undroppable, uploading: uploading}"\n\t\t\t:id="formId"\n\t\t\t@submit.prevent="submitForm" ref="form">\n\t\t\t<input type="hidden" name="_wpnonce" :value="nonce" />\n\t\t\t<input type="hidden" name="id" :value="postId" />\n\t\t\t<div :class="{\'taroimg-dropzone\': true, on: onDrag}"\n\t\t\t    @dragover.prevent.stop="dragOver"\n\t\t\t    @dragenter.prevent.stop="dragEnter"\n\t\t\t    @dragLeave.prevent.stop="dragLeave"\n\t\t\t    @drop.prevent="dropHandler"\n\t\t\t    >\n\t\t\t\t<p class="taroimg-description">\n\t\t\t\t\t<span v-if="!undroppable" class="taroimg-drop-here">\n\t\t\t\t\t    {{dropMsg}}\n\t\t\t\t\t    <br />\n                    </span>\n\t\t\t\t\t<button class="taroimg-button" type="button" @click="openFile">{{btnLabel}}</button>\n\t\t\t\t</p>\n\t\t\t\t\n\t\t\t\t<div class="taroimg-progress-bar">\n\t\t\t\t\t<div class="taroimg-progress-inner" :style="{width: percentile}"></div>\n\t\t\t\t\t<div class="taroimg-progress-text">{{percentile}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<input class="taroimg-input" type="file" name="file" @change="fileChangeHandler" ref="file">\n    </form>\n    </div>\n    ',data:function(){return{dropMsg:TaroimgUploader.dropMsg,uploading:!1,undroppable:!window.FileReader,btnLabel:TaroimgUploader.btnLabel,nonce:TaroimgUploader.nonce,loaded:0,total:0,onDrag:!1}},props:{directory:{type:String,required:!0},postId:{type:Number,required:!1,default:0}},computed:{actionUrl:function(){return TaroimgUploader.endpoint+this.directory},formId:function(){return"taroimg-"+this.directory},percentile:function(){return this.total?Math.round(this.loaded/this.total*100)+"%":""}},methods:{upload:function(n,e){if(!this.uploading){this.uploading=!0;var r=this;t.ajax({url:n.attr("action"),method:"post",dataType:"json",data:e,processData:!1,contentType:!1,xhr:function(){var n=t.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(t){r.loaded=t.loaded,r.total=t.total},!1),n}}).done(function(t){n[0].reset(),r.$emit("upload-finished",t)}).fail(function(t){r.$emit("upload-error",t)}).always(function(){r.uploading=!1,r.loaded=0,r.total=0})}},submitForm:function(){var n=t(this.$refs.form),e=new FormData(this.$refs.form);this.upload(n,e)},openFile:function(){this.$refs.file.dispatchEvent(new Event("click"))},fileChangeHandler:function(t){t.target.files.length&&this.submitForm()},dragOver:function(t){return this.onDrag=!0,!1},dragEnter:function(){return!1},dragLeave:function(){return this.onDrag=!1,!1},dropHandler:function(n){if(!n.dataTransfer.files.length)return!1;n.stopPropagation();var e=n.dataTransfer.files[0],r=this.$refs.form,o=new FormData(r);return o.append("file",e),this.upload(t(r),o),!1}}})}(jQuery);
//# sourceMappingURL=../map/components/uploader.js.map
