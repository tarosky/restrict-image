"use strict";
/*!
 * Image container
 *
 * wpdeps=taroimg-uploader
 */
/*!
 * Image container
 *
 * wpdeps=taroimg-uploader
 */
!function(e){Vue.component("taroimg-item",{template:'\n      <div :class="{\'taroimg-item\': true, \'deleting\': deleting}" :style="containerStyle">\n          <button v-if="!image.protected" class="taroimg-item-delete" type="button" @click="deleteImage">&times;</button>\n          <img class="taroimg-item-thumbnail" :src="image.thumbnail" :alt="image.title" v-if="image.thumbnail" />\n          <span class="taroimg-item-label">{{image.name}}</span>\n      </div>\n    ',data:function(){return{deleting:!1}},computed:{containerStyle:function(){return{width:TaroimgContainer.width+"px"}}},props:{image:{type:Object,default:null},endpoint:{type:String,required:!0}},methods:{deleteImage:function(){if(!this.image.protected){var t=this;this.deleting=!0,e.ajax({method:"delete",url:this.endpoint+"?attachment="+t.image.id,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",TaroimgContainer.nonce)}}).done(function(e,i,n){t.$emit("delete-image",!0,t.image.id,"")}).fail(function(e){var i="";e.responseJSON&&e.responseJSON.message&&(i=e.responseJSON.message),t.$emit("delete-image",!1,t.image.id,i)}).always(function(){t.deleting=!1})}}}}),Vue.component("taroimg-container",{template:'\n    <div>\n        <div class="taroimg-list">\n            <taroimg-item v-for="image in images" :key="image.id" :endpoint="endpoint" :image="image" @delete-image="deleteImage">\n            </taroimg-item>\n        </div>\n        <taroimg-uploader v-if="uploadable" :directory="directory" :post-id="postId" @upload-finished="uploadHandler" @upload-error="uploadErrorHandler"></taroimg-uploader>\n    </div>\n    ',data:function(){return{images:[],limit:0,loading:!1}},props:{directory:{type:String,required:!0},postId:{type:Number,required:!1,default:0},allowUpload:{type:Boolean,required:!1,default:!0}},computed:{uploadable:function(){return(0===this.limit||this.images.length<this.limit)&&this.allowUpload},endpoint:function(){return TaroimgContainer.endpoint+this.directory}},mounted:function(){this.getImageList(function(e,t,i){})},methods:{throwError:function(e){this.$emit("on-error",e)},uploadHandler:function(e){this.images.push(e)},uploadErrorHandler:function(e){var t="";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),this.throwError(t)},getImageList:function(t){var i=this;this.loading=!0;var n=this.endpoint;this.postId&&(n=""+n+(/\?/.test(n)?"&":"?")+"id="+this.postId);e.ajax({method:"get",url:n,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",TaroimgContainer.nonce)}}).done(function(e,n,o){i.images=e.media,i.limit=e.limit,t&&t(e,n,o)}).fail(function(e){var t="";e.responseJSON&&e.responseJSON.message&&(t=e.responseJSON.message),i.throwError(t)}).always(function(){i.loading=!1})},deleteImage:function(e,t,i){if(e){var n=null,o=null;this.images.forEach(function(e,i){if(t===e.id)return n=i,o=e,!1}),null===n?this.throwError(TaroimgContainer.noImageToDelete):(this.images.splice(n,1),this.$emit("image-deleted",o))}else this.throwError(i)}}})}(jQuery);
//# sourceMappingURL=../map/components/container.js.map
